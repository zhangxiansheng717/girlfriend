<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ’– å½­ç¥æŸ”ä¸“å±å¹¸è¿ç›²ç›’</title>
    <style>
        :root {
            --primary-color: #ff7675;
        }

        body {
            background: linear-gradient(135deg, #fad0c4 0%, #ffd1ff 100%);
            font-family: 'PingFang SC', sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden; /* ç¦æ­¢æ•´ä½“æ»šåŠ¨ */
            position: relative;
        }

        /* === 1. ä¿®å¤èƒŒæ™¯æ³¡æ³¡ === */
        .particles {
            position: fixed; /* å¼ºåˆ¶å›ºå®šåœ¨å±å¹•èƒŒå */
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; /* æœ€åº•å±‚ */
            pointer-events: none;
        }
        .particle {
            position: absolute;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            animation: floatUp linear infinite;
        }

        /* é¡¶éƒ¨æ ‡é¢˜ */
        .header {
            margin-top: 20px;
            z-index: 10;
            flex-shrink: 0;
        }
        .score-pill {
            background: rgba(255,255,255,0.9);
            padding: 8px 25px;
            border-radius: 40px;
            box-shadow: 0 5px 15px rgba(255, 118, 117, 0.2);
            text-align: center;
            border: 2px solid #fff;
        }
        .score-val { color: var(--primary-color); font-weight: 800; font-size: 26px; }

        /* === 2. ä¿®å¤è½¬ç›˜å¸ƒå±€ === */
        .wheel-wrapper {
            position: relative;
            width: 320px;
            height: 320px;
            margin: 20px 0;
            flex-shrink: 0; /* ä¸¥ç¦å˜å½¢ */
            z-index: 10;
        }

        .pointer {
            position: absolute;
            top: -20px; left: 50%;
            transform: translateX(-50%);
            width: 40px; height: 50px;
            background-image: url("data:image/svg+xml,%3Csvg width='40' height='50' viewBox='0 0 40 50' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20 50L0 0H40L20 50Z' fill='%23ff4757' stroke='white' stroke-width='4'/%3E%3C/svg%3E");
            z-index: 30;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }

        #wheel {
			box-sizing: border-box; /* âœ¨ åŠ ä¸Šè¿™ä¸€è¡Œæ ¸å¿ƒä»£ç  */
			width: 100%; 
			height: 100%;
			border-radius: 50%;
			border: 8px solid #fff;
			position: relative;
			background: #fff;
			transition: transform 8s cubic-bezier(0.15, 0, 0.15, 1);
			overflow: hidden;
			box-shadow: 0 10px 20px rgba(0,0,0,0.1);
		}

        /* === 3. æ ¸å¿ƒä¿®å¤ï¼šæ–‡å­—å®šä½ç³»ç»Ÿ === */
        /* æ–‡å­—å®¹å™¨ï¼šåƒæ—¶é’ŸæŒ‡é’ˆä¸€æ ·ä»åœ†å¿ƒå°„å‘å¤–åœˆ */
        .wheel-label {
            position: absolute;
            top: 50%; left: 50%;
            width: 50%; /* é•¿åº¦ç­‰äºåŠå¾„ */
            height: 0px; 
            transform-origin: 0% 50%; /* å…³é”®ï¼é”šç‚¹è®¾åœ¨å·¦ä¾§(åœ†å¿ƒ) */
            z-index: 5;
            display: flex;
            justify-content: flex-end; /* æŠŠæ–‡å­—æ¨åˆ°æœ€å¤–ä¾§ */
            align-items: center;
            padding-right: 35px; /* ç¦»è¾¹ç¼˜çš„è·ç¦» */
            box-sizing: border-box;
        }
        
        /* æ–‡å­—æœ¬ä½“ */
        .wheel-text {
            color: #fff;
            font-weight: 900;
            font-size: 16px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
            white-space: nowrap;
            /* è¿™é‡Œçš„æ—‹è½¬ç”± JS åŠ¨æ€æ§åˆ¶(é˜²æ­¢å€’ç«‹) */
        }

        .center-btn {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 76px; height: 76px;
            background: #fff;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: var(--primary-color);
            font-weight: 800; font-size: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            cursor: pointer;
            z-index: 40;
            border: 4px solid #f0f0f0;
        }

        /* åº•éƒ¨åˆ—è¡¨åŒº */
        .dashboard {
            flex: 1; /* å æ»¡å‰©ä½™ç©ºé—´ */
            width: 92%; max-width: 400px;
            background: rgba(255,255,255,0.9);
            border-radius: 24px 24px 0 0;
            padding: 20px;
            box-sizing: border-box;
            display: flex; flex-direction: column;
            backdrop-filter: blur(10px);
            box-shadow: 0 -5px 30px rgba(0,0,0,0.05);
            min-height: 0; /* å…è®¸æ»šåŠ¨ */
            z-index: 10;
        }

        .tabs { display: flex; background: #f1f2f6; border-radius: 12px; padding: 4px; margin-bottom: 15px; flex-shrink: 0; }
        .tab { flex: 1; text-align: center; padding: 10px; font-size: 14px; font-weight: bold; color: #999; border-radius: 10px; transition:0.3s; }
        .tab.active { background: #fff; color: var(--primary-color); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

        .list-wrapper {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            -webkit-overflow-scrolling: touch;
        }
        .list-wrapper::-webkit-scrollbar { width: 0; }

        .log-item { background: #fff; margin-bottom: 8px; padding: 12px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; }
        .log-title { font-weight: bold; color: #333; font-size: 14px; }
        .log-desc { font-size: 12px; color: #999; margin-top: 2px; }
        
        .redeem-btn {
            flex-shrink: 0;
            width: 100%; padding: 15px;
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: #fff; border: none; border-radius: 16px;
            font-size: 16px; font-weight: bold;
            box-shadow: 0 8px 20px rgba(108, 92, 231, 0.3);
        }
        .redeem-btn:disabled { background: #dfe6e9; color: #b2bec3; box-shadow: none; }

        /* å¼¹çª— */
        .modal-mask { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:none; justify-content:center; align-items:center; z-index:99; backdrop-filter: blur(5px); }
        .modal-box { background:#fff; padding:30px; border-radius:24px; width:75%; max-width:300px; text-align:center; animation: popIn 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28); }
        .modal-btn { background:var(--primary-color); color:#fff; padding:12px 35px; border:none; border-radius:50px; margin-top:20px; font-size:15px; font-weight:bold; box-shadow: 0 5px 15px rgba(255, 118, 117, 0.3); }
        .modal-btn.cancel { background: #f1f2f6; color: #888; box-shadow: none; margin-right: 10px; }

        @keyframes floatUp { 0% {transform:translateY(100vh);opacity:0;} 50%{opacity:0.6;} 100%{transform:translateY(-100px);opacity:0;} }
        @keyframes popIn { from {transform:scale(0.8);opacity:0;} to {transform:scale(1);opacity:1;} }
    </style>
</head>
<body>

    <!-- èƒŒæ™¯æ³¡æ³¡ -->
    <div class="particles" id="particles"></div>

    <div class="header">
        <div class="score-pill">
            <div style="font-size:12px; color:#aaa;">å½“å‰æ‹çˆ±ç§¯åˆ†</div>
            <div class="score-val" id="scoreVal">0</div>
        </div>
    </div>

    <div class="wheel-wrapper">
        <div class="pointer"></div>
        <div id="wheel"></div>
        <div class="center-btn" onclick="spin()">GO</div>
    </div>

    <div class="dashboard">
        <div class="tabs">
            <div class="tab active" onclick="switchTab('spin')" id="tabSpin">ğŸ è·èµ è®°å½•</div>
            <div class="tab" onclick="switchTab('redeem')" id="tabRedeem">ğŸ“œ å…‘æ¢æ¡£æ¡ˆ</div>
        </div>
        
        <div class="list-wrapper">
            <div id="listContainer"></div>
        </div>

        <button class="redeem-btn" id="redeemBtn" onclick="askRedeem()">
            âœ¨ å…‘æ¢ä¿åº•å¤§å¥– (500åˆ†)
        </button>
    </div>

    <!-- ç»“æœå¼¹çª— -->
    <div class="modal-mask" id="resultModal">
        <div class="modal-box">
            <div style="font-size:48px; margin-bottom:10px;">ğŸ‰</div>
            <h3 id="rTitle" style="margin:0; font-size:20px; color:#333;"></h3>
            <p id="rDesc" style="color:#666; margin-top:10px; line-height:1.5;"></p>
            <button class="modal-btn" onclick="closeModal('resultModal')">å¼€å¿ƒæ”¶ä¸‹</button>
        </div>
    </div>

    <!-- ç¡®è®¤å¼¹çª— -->
    <div class="modal-mask" id="confirmModal">
        <div class="modal-box">
            <div style="font-size:48px; margin-bottom:10px;">ğŸ’</div>
            <h3 style="margin:0; font-size:20px;">å…‘æ¢å¤§ä¿åº•</h3>
            <p style="color:#666; font-size:14px; margin:15px 0;">
                ç¡®å®šæ¶ˆè€— 500 ç§¯åˆ†å…‘æ¢<br>
                <b style="color:#6c5ce7;">ä»»é€‰ä¸€ä»¶ä¸€åƒå…ƒä»¥å†…çš„ç¤¼ç‰©</b> å—ï¼Ÿ
            </p>
            <button class="modal-btn cancel" onclick="closeModal('confirmModal')">å–æ¶ˆ</button>
            <button class="modal-btn" onclick="doRedeem()">ç¡®è®¤å…‘æ¢</button>
        </div>
    </div>

    <script>
        const config = {
            redeemCost: 500,
            prizes: [
                // ç¡®ä¿ S çº§çº¢è‰²æœ€æ˜¾çœ¼
                { grade: "Sçº§", name: "ä»·å€¼400-500å…ƒ è±ªåç¤¼ç›’", score: 10,  weight: 5,  color: "#ff4757" },
                { grade: "Açº§", name: "ä»·å€¼300-400å…ƒ æƒŠå–œå•å“", score: 30,  weight: 15, color: "#ffa502" },
                { grade: "Bçº§", name: "ä»·å€¼200-300å…ƒ ä¸¥é€‰ç¤¼ç‰©", score: 60,  weight: 30, color: "#2ed573" },
                { grade: "Cçº§", name: "ä»·å€¼100-200å…ƒ å®ç”¨å¥½ç‰©", score: 100, weight: 30, color: "#1e90ff" },
                { grade: "Dçº§", name: "ä»·å€¼100å…ƒå†… å¿ƒæ„ç›²ç›’",   score: 150, weight: 20, color: "#a4b0be" }
            ]
        };

        let totalScore = parseInt(localStorage.getItem('loveScore')) || 0;
        let history = JSON.parse(localStorage.getItem('loveHistory')) || [];
        let currentTab = 'spin';
        
        const wheelEl = document.getElementById('wheel');
        const scoreEl = document.getElementById('scoreVal');
        const listEl = document.getElementById('listContainer');
        const redeemBtn = document.getElementById('redeemBtn');

        function init() {
            // ç”Ÿæˆæ³¡æ³¡
            const box = document.getElementById('particles');
            for(let i=0; i<20; i++){
                let p = document.createElement('div');
                p.className = 'particle';
                let s = Math.random()*8 + 4 + 'px';
                p.style.width = s; p.style.height = s;
                p.style.left = Math.random()*100 + '%';
                p.style.animation = `floatUp ${Math.random()*10 + 10}s linear infinite`;
                box.appendChild(p);
            }
            drawWheel();
            updateUI();
        }

        // === æ ¸å¿ƒç»˜åˆ¶é€»è¾‘ ===
		function drawWheel() {
			let deg = 0;
			const totalW = config.prizes.reduce((a,b)=>a+b.weight,0);
			let grad = [];

			wheelEl.innerHTML = '';
			
			config.prizes.forEach(p => {
				const sliceDeg = (p.weight/totalW)*360;
				
				// 1. æ‰‡å½¢é¢œè‰²
				grad.push(`${p.color} ${deg}deg ${deg + sliceDeg}deg`);
				
				// 2. æ–‡å­—å®šä½
				const label = document.createElement('div');
				label.className = 'wheel-label';
				// æ—‹è½¬åˆ°æ‰‡å½¢ä¸­é—´
				let midDeg = deg + sliceDeg/2;
				
				// ã€æ ¸å¿ƒä¿®å¤ã€‘è¿™é‡Œå‡å»90åº¦ï¼Œè®©æ–‡å­—é€»è¾‘(é»˜è®¤å‘å³)å¯¹é½èƒŒæ™¯é€»è¾‘(é»˜è®¤å‘ä¸Š)
				label.style.transform = `rotate(${midDeg - 90}deg)`;
				
				const text = document.createElement('span');
				text.className = 'wheel-text';
				text.innerText = p.grade;

				// 3. æ™ºèƒ½ç¿»è½¬æ–‡å­—ï¼šé˜²æ­¢ä¸‹åŠåœ†çš„æ–‡å­—å€’ç«‹éš¾çœ‹
				// å› ä¸º midDeg 0åº¦ä»£è¡¨12ç‚¹é’Ÿï¼Œæ‰€ä»¥ 90~270åº¦ ä»£è¡¨ä¸‹åŠåœ†
				if(midDeg > 90 && midDeg < 270) {
					text.style.transform = 'rotate(180deg)';
				}

				label.appendChild(text);
				wheelEl.appendChild(label);

				deg += sliceDeg;
			});
			wheelEl.style.background = `conic-gradient(${grad.join(',')})`;
		}

        let rot = 0;
        let isSpinning = false;
        function spin() {
            if(isSpinning) return;
            isSpinning = true;

            const totalW = config.prizes.reduce((a,b)=>a+b.weight,0);
            let r = Math.random()*totalW;
            let p = null;
            for(let item of config.prizes){
                r -= item.weight;
                if(r<=0) { p = item; break; }
            }
            if(!p) p = config.prizes[config.prizes.length-1];

            // ç®—å‡ºç›®æ ‡è§’åº¦
            let currentDeg = 0;
            for(let item of config.prizes) {
                if(item === p) break;
                currentDeg += (item.weight/totalW)*360;
            }
            const sliceDeg = (p.weight/totalW)*360;
            const centerDeg = currentDeg + sliceDeg/2;
            
            // æŒ‡é’ˆåœ¨ä¸Šæ–¹(0åº¦)ï¼Œç›®æ ‡æ˜¯è®© centerDeg è½¬åˆ° 0 åº¦ (360)
            // åŠ ä¸Šéšæœºåç§»
            const offset = (Math.random()-0.5) * sliceDeg * 0.4;
            const target = 360 - (centerDeg + offset);

            rot += 360*8 + (target - rot%360);
            wheelEl.style.transform = `rotate(${rot}deg)`;

            setTimeout(() => {
                isSpinning = false;
                addLog('spin', p.grade, p.name, p.score);
                showResult(p.grade + 'æƒŠå–œ', p.name, `ç§¯åˆ† +${p.score}`);
            }, 8000);
        }

        function addLog(type, title, desc, score) {
            totalScore += score;
            history.unshift({type, title, desc, score, time: new Date().toLocaleDateString()});
            save();
        }

        function save() {
            localStorage.setItem('loveScore', totalScore);
            localStorage.setItem('loveHistory', JSON.stringify(history));
            updateUI();
        }

        function updateUI() {
            scoreEl.innerText = totalScore;
            
            if(totalScore >= config.redeemCost) {
                redeemBtn.disabled = false;
                redeemBtn.innerHTML = "âœ¨ ç«‹å³å…‘æ¢ä¿åº•å¤§å¥– âœ¨";
            } else {
                redeemBtn.disabled = true;
                redeemBtn.innerHTML = `è¿˜å·® ${config.redeemCost - totalScore} åˆ†å…‘æ¢`;
            }

            const list = history.filter(h => h.type === currentTab);
            listEl.innerHTML = list.length ? list.map(h => `
                <div class="log-item">
                    <div>
                        <div class="log-title">${h.title}</div>
                        <div class="log-desc">${h.desc} | ${h.time}</div>
                    </div>
                    <div style="font-weight:bold; color:${h.score>0?'#2ed573':'#6c5ce7'}">
                        ${h.score>0?'+':''}${h.score}
                    </div>
                </div>
            `).join('') : '<div style="text-align:center;color:#ccc;padding:20px;">æš‚æ— è®°å½•</div>';
        }

        function switchTab(t) {
            currentTab = t;
            document.getElementById('tabSpin').className = t==='spin'?'tab active':'tab';
            document.getElementById('tabRedeem').className = t==='redeem'?'tab active':'tab';
            updateUI();
        }

        function doRedeem() {
            closeModal('confirmModal');
            addLog('redeem', 'å…‘æ¢æˆåŠŸ', 'æ¶ˆè€—ç§¯åˆ†', -config.redeemCost);
            setTimeout(() => {
                showResult('å…‘æ¢æˆåŠŸ', 'å·²æ‰£é™¤ç§¯åˆ†', 'å¿«å»æˆªå›¾å‘ç»™ç”·æœ‹å‹ï¼');
            }, 300);
        }

        function showResult(title, desc, sub) {
            document.getElementById('rTitle').innerText = title;
            document.getElementById('rDesc').innerHTML = `<b>${desc}</b><br><span style="color:#ff7675; font-size:14px; margin-top:5px; display:inline-block">${sub}</span>`;
            document.getElementById('resultModal').style.display = 'flex';
        }
        function askRedeem() { document.getElementById('confirmModal').style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        init();
    </script>
</body>
</html>
